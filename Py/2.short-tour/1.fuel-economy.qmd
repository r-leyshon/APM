---
title: "US Fuel Economy Dataset"
format:
  html:
    code-fold: true
jupyter: python3
---
```{python}
import os
import re
from urllib.request import urlopen
from zipfile import ZipFile

from pyprojroot import here
from io import BytesIO
import pandas as pd

```

```{python}
cars2010 = "https://www.fueleconomy.gov/feg/epadata/10data.zip"
cars2011 = "https://www.fueleconomy.gov/feg/epadata/11data.zip"
cars_remotes = list([cars2010, cars2011])
target_pth = os.path.join(here(), "..", "data", "cars")
```

```{python}
def ingest_remote_zips(url_list: list, pth: str):
    """
    Read some remote zipfiles to disk. 

    Parameters
    ----------
    url_list: List of urls to attempt read

    pth: Path to write directory.

    Returns
    -------
    None
    """
    pth = os.path.normpath(pth)
    try:
        os.makedirs(pth)
    except FileExistsError:
        pass
    for url in url_list:
        with urlopen(url) as url_resp:
            with ZipFile(BytesIO(url_resp.read()), mode="r") as zipf:
                for f in zipf.filelist:
                    zipf.extract(f, pth)
    return None
```

```{python}
# write files to disk
ingest_remote_zips(cars_remotes, target_pth)
```

```{python}
# look in the data folder for cars files
files = os.listdir(target_pth)
pat_2010 = re.compile("2010")
pat_2011 = re.compile("2011")
filenm_2010 = files[[i for i, f in enumerate(files) if bool(pat_2010.search(f))][0]]
filenm_2011 = files[[i for i, f in enumerate(files) if bool(pat_2011.search(f))][0]]
```

```{python}
# import cars files
cars_2010 = pd.read_excel(filenm_2010)
cars_2011 = pd.read_excel(filenm_2011)
```
